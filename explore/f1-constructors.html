<!DOCTYPE html>
<html>

<head>
    <title>f1 constructors</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <style>
    div#all_seasons_edges {
        position: absolute;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        z-index: 0;
        display: hidden;
    }

    svg#all_seasons {
        border: 0px solid red;
        z-index: 1;
    }

    rect.bar {
        fill: CornflowerBlue;
    }

    rect.bar:hover {
        fill: orange;
    }
    </style>
</head>

<body>
    <h1 id="pagetitle">F1 constructors</h1>
    <div id="edges"></div>
    <table id="list_constructors" class="table">
        <thead>
            <tr>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="js/rdm.js"></script>
    <script>
    (function() {

        this.columns = [{
                "title": "Constructor",
                "df": function(d) { return d.name; },
            },
            {
                "title": "Nationality",
                "df": function(d) { return d.nationality; },
            },
            {
                "title": "Races",
                "df": function(d) {
                    var res = d.years_active.length ? d.years_active.reduce(rdm.reduce_sum('races')) : { "races": 0 };
                    return res.races;
                },
            },
            {
                "title": "Wins",
                "df": function(d) {
                    var res = d.years_active.length ? d.years_active.reduce(rdm.reduce_sum('wins')) : { "wins": 0 };
                    return res.wins;
                },
            },
            {
                "title": "Podiums",
                "df": function(d) {
                    var res = d.years_active.length ? d.years_active.reduce(rdm.reduce_sum('podiums')) : { "podiums": 0 };
                    return res.podiums;
                },
            },
            {
                "title": "First Entry",
                "df": function(d) {
                    var res = d.years_active.length ? d.years_active.reduce(rdm.reduce_min('year')) : { "year": 0 };
                    return res.year;
                },
            },
            {
                "title": "Last Entry",
                "df": function(d) {
                    var res = d.years_active.length ? d.years_active.reduce(rdm.reduce_max('year')) : { "year": 0 };
                    return res.year;
                },
            },
        ]

        this.loaded_data = {};

        this.initCharts = function() {
            d3.select('table#list_constructors thead').selectAll('th')
                .data(rdm.columns)
                .enter()
                .append('th')
                .text(function(d) { return d.title })

            ;

            rdm.loadData();
        }

        this.loadData = function() {
            var uri = "/racing-data-munging/data/ergast/constructors.json"
            d3.json(uri)
                .then(
                    function(data) {
                        rdm.loaded_data['constructors_list'] = data;
                        rdm.update_constructors_overview(rdm.loaded_data['constructors_list'])
                    }
                );
        }

        this.sortby = function(sort_term) {

            update_constructors_overview();
        }

        this.update_constructors_overview = function(data) {
            console.log(data)
            var tbody = d3.select('table#list_constructors tbody');
            tbody.selectAll("tr").remove();

            var rows = tbody.selectAll('tr').data(data);

            addrows = rows.enter().append('tr');

            for (var i = 0; i < rdm.columns.length; i++) {
                addrows.append("td").attr("class", "name").text(rdm.columns[i].df);
            }
        }
    }).apply(rdm);

    rdm.initCharts();
    </script>
</body>

</html>