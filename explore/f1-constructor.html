<!DOCTYPE html>
<html>

<head>
    <title>f1 constructor results</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="inc/rdm.css">
</head>

<body>
    <h1 id="pagetitle">F1 constructor results</h1>
    <div id="edges"></div>
    <table id="list_results" class="table">
        <thead>
            <tr>
                <th rowspan="2">year</th>
                <th rowspan="2">driver</th>
                <th colspan="3">round</th>
                <th rowspan="2">points</th>
                <th rowspan="2">driver position</th>
                <th rowspan="2">constructor position</th>
            </tr>
            </tr>
            <tr id="rounds">
                <th>1</th>
                <th>2</th>
                <th>3</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="inc/rdm.js"></script>
    <script>
    (function() {

        var constructor_ref = rdm.url.searchParams.get("ref");
        // console.log(constructor_ref);

        this.initCharts = function() {

            rdm.loadData();
        }

        this.loadData = function() {
            var uri = "/racing-data-munging/data/ergast/constructors/" + constructor_ref + ".json"
            d3.json(uri)
                .then(
                    function(data) {
                        rdm.loaded_data['constructor'] = data;
                        d3.select('h1#pagetitle').text(`F1 constructor results - ${data['name']}`);
                        rdm.update_constructor_overview(rdm.loaded_data['constructor'])
                    }
                );
        }

        this.update_constructor_overview = function(data) {
            var results_nested = d3.nest()
                .key(function(d) { return `${d.year}-${d.driverRef}` })
                .sortKeys(d3.ascending)
                .entries(data.results);

            var tbody = d3.select('table#list_results tbody');
            tbody.selectAll("tr").remove();

            var rows = tbody.selectAll('tr').data(results_nested);
            var addrows = rows.enter().append('tr');


            console.log(results_nested);
        }
    }).apply(rdm);

    rdm.initCharts();
    </script>
</body>

</html>